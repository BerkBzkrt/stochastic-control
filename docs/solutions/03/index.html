<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Aditya Mahajan" />
  <meta name="title" content="ECSE 506: Stochastic Control and Decision Theory" />
  <title>ECSE 506: Stochastic Control and Decision Theory</title>
  

  <link rel="stylesheet" href="https://adityam.github.io/stochastic-control//css/style.css" type="text/css" /><link rel="stylesheet" href="https://adityam.github.io/stochastic-control//css/github.css" type="text/css" />
  <script src="https://adityam.github.io/stochastic-control//js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script><script type="text/javascript"
    src="https://adityam.github.io/stochastic-control/js/mathjax-local.js" defer>
  </script>
  <script type="text/javascript" id="MathJax-script" defer
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
  </script>

  <script type="module" defer
    src="//instant.page/3.0.0"
    integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1">
  </script>

  <script>var clicky_site_ids = clicky_site_ids || []; clicky_site_ids.push(101261731);</script>
  <script async src="//static.getclicky.com/js"></script>

</head>
<body>
<div id="content">
<div class="title">
  <h1>ECSE 506: Stochastic Control and Decision Theory </h1>
  <h2><a href="http://www.cim.mcgill.ca/~adityam/">Aditya Mahajan</a> <br/>
      Winter 2022
  </h2>
  <h3><a href="https://adityam.github.io/stochastic-control/ ">About</a>
	&nbsp;<small><small>|</small></small>&nbsp;
    <a href="https://adityam.github.io/stochastic-control//lectures">Lectures</a></span>
	&nbsp;<small><small>|</small></small>&nbsp;
    <a href="https://adityam.github.io/stochastic-control//notes">Notes</a></span>
	&nbsp;<small><small>|</small></small>&nbsp;
    <a href="https://adityam.github.io/stochastic-control//coursework">Coursework</a>
</h3>
</div>



<div class="h1-title">Assignment 3 (solution)</div>

<h2 data-number="0.1" id="problem-1"><span class="header-section-number">0.1</span> Problem 1</h2>
<p>The code for computing the optimal policy is <a href="queueing.jl">available here</a>. The code is written for ease of reading, not efficiency.</p>
<div class="highlight">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">using</span> Distributions, OffsetArrays

<span style="color:#75715e"># Parameters</span>
n, m  <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">3</span>
λ <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>

μ <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0.2</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.8</span>]
q <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">8</span>]

h <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
R <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
B <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>

<span style="color:#75715e"># State spaces</span>
S <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span>n
A <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>m
W <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span>B
Z <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>

<span style="color:#75715e"># Dynamics</span>
f(s,z,w) <span style="color:#f92672">=</span> min( max(s<span style="color:#f92672">-</span>z, <span style="color:#ae81ff">0</span>) <span style="color:#f92672">+</span> w, n)

<span style="color:#75715e"># Arrival probability</span>
Pw(w) <span style="color:#f92672">=</span> pdf(Poisson(λ),w)

<span style="color:#75715e"># Departure probability</span>
Pz(z,s,a) <span style="color:#f92672">=</span> (s <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) <span style="color:#f92672">?</span> convert(<span style="color:#66d9ef">Int</span>, z<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>) <span style="color:#f92672">:</span> pdf(Bernoulli(μ[a]),z)

<span style="color:#75715e"># Cost</span>
c(s,z,a) <span style="color:#f92672">=</span> h<span style="color:#f92672">*</span>s <span style="color:#f92672">+</span> q[a] <span style="color:#f92672">-</span> R<span style="color:#f92672">*</span>z

<span style="color:#75715e"># Dynamic programming</span>
T <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>

V <span style="color:#f92672">=</span> [ OffsetArray(zeros(length(S)), S)               <span style="color:#66d9ef">for</span> t <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>T<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] 
Q <span style="color:#f92672">=</span> [ OffsetArray(zeros(length(S),length(A)), S,A)   <span style="color:#66d9ef">for</span> t <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>T]
π <span style="color:#f92672">=</span> [ OffsetArray(zeros(<span style="color:#66d9ef">Int</span>, length(S)), S)          <span style="color:#66d9ef">for</span> t <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>T]

<span style="color:#66d9ef">for</span> t <span style="color:#66d9ef">in</span> T<span style="color:#f92672">:-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>
    <span style="color:#a6e22e">@views</span> Qt <span style="color:#f92672">=</span> Q[t]
    <span style="color:#66d9ef">for</span> s <span style="color:#66d9ef">in</span> S 
        <span style="color:#66d9ef">for</span> a <span style="color:#66d9ef">in</span> A
          Qt[s, a] <span style="color:#f92672">=</span> sum(Pw(w)<span style="color:#f92672">*</span>Pz(z,s,a)<span style="color:#f92672">*</span>( c(s,z,a) <span style="color:#f92672">+</span> V[t<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][f(s,z,w)] ) <span style="color:#66d9ef">for</span> w <span style="color:#66d9ef">in</span> W, z <span style="color:#66d9ef">in</span> Z)
        <span style="color:#66d9ef">end</span>
        idx <span style="color:#f92672">=</span> argmin(Qt[s,<span style="color:#f92672">:</span>])
        V[t][s] <span style="color:#f92672">=</span> Qt[s, idx]
        π[t][s] <span style="color:#f92672">=</span> idx 
    <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

display(hcat(V[<span style="color:#ae81ff">1</span>], V[<span style="color:#ae81ff">5</span>], V[<span style="color:#ae81ff">10</span>], V[<span style="color:#ae81ff">25</span>]))
display(hcat(π[<span style="color:#ae81ff">1</span>], π[<span style="color:#ae81ff">5</span>], π[<span style="color:#ae81ff">10</span>], π[<span style="color:#ae81ff">25</span>]))

</code></pre>
</div>
<p>The value functions are shown below.</p>
<p><img src="queueing.png" style="width:100.0%" /></p>
<p>The optimal policy at the corresponding times is:</p>
<pre><code>┌ Info: Optimal policy
│   [g[1], g[50], g[75], g[95]] =
│    4-element Array{Array{Int64,1},1}:
│     [0, 2, 3, 3, 3, 3, 3, 2, 1]
│     [0, 2, 3, 3, 3, 3, 2, 2, 1]
│     [0, 2, 2, 2, 2, 2, 2, 1, 1]
└     [0, 1, 1, 1, 1, 1, 1, 1, 1]</code></pre>
<h2 data-number="0.2" id="problem-2"><span class="header-section-number">0.2</span> Problem 2</h2>
<p>The code for computing the optimal policy is <a href="iot.jl">available here</a>. Note that we save a lot of explicit calculations by comuting the probability of landing in a bin in terms of differences of CDFs rather than an integral of the PDF.</p>
<div class="highlight">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">using</span> Distributions, OffsetArrays
<span style="color:#66d9ef">using</span> PyPlot

Pw(w) <span style="color:#f92672">=</span> (abs(w) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">?</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">-</span> abs(w)<span style="color:#f92672">/</span><span style="color:#ae81ff">25</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span> 
λ <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
B <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>

<span style="color:#75715e"># State spaces</span>
S <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>B<span style="color:#f92672">:</span>B
A <span style="color:#f92672">=</span>  <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>
W <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>

<span style="color:#75715e"># Dynamics</span>
f(s,a,w) <span style="color:#f92672">=</span> clip(s<span style="color:#f92672">*</span>(a<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>) <span style="color:#f92672">+</span> w, <span style="color:#f92672">-</span>B, B) 
clip(x,L,U) <span style="color:#f92672">=</span> max( min(x,U), L)

<span style="color:#75715e"># cost</span>
c(s,a) <span style="color:#f92672">=</span> λ <span style="color:#f92672">*</span> a <span style="color:#f92672">+</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> a)<span style="color:#f92672">*</span>s<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span>

T <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>

V <span style="color:#f92672">=</span> [ OffsetArray(zeros(length(S)), S) <span style="color:#66d9ef">for</span> t <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>T<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span> ]
π <span style="color:#f92672">=</span> [ OffsetArray(zeros(<span style="color:#66d9ef">Int</span>, length(S)), S) <span style="color:#66d9ef">for</span> t <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>T ]
Q <span style="color:#f92672">=</span> [ OffsetArray(zeros(length(S), length(A)), S,A) <span style="color:#66d9ef">for</span> t <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>T ]

<span style="color:#66d9ef">for</span> t <span style="color:#66d9ef">in</span> T<span style="color:#f92672">:-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>
    <span style="color:#a6e22e">@views</span> Qt <span style="color:#f92672">=</span> Q[t]
    <span style="color:#66d9ef">for</span> s <span style="color:#66d9ef">in</span> S 
        <span style="color:#66d9ef">for</span> a <span style="color:#66d9ef">in</span> A
          Qt[s, a] <span style="color:#f92672">=</span> c(s,a) <span style="color:#f92672">+</span> sum(Pw(w) <span style="color:#f92672">*</span> V[t<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][f(s,a,w)] <span style="color:#66d9ef">for</span> w <span style="color:#66d9ef">in</span> W)
        <span style="color:#66d9ef">end</span>
        idx <span style="color:#f92672">=</span> argmin(Qt[s,<span style="color:#f92672">:</span>])
        V[t][s] <span style="color:#f92672">=</span> Qt[s, idx]
        π[t][s] <span style="color:#f92672">=</span> idx 
    <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>


</code></pre>
</div>
<p>The value functions are shown below:</p>
<p><img src="iot.png" style="width:100.0%" /></p>


<p class="categories">
This entry 

 was last updated on 06 Feb 2020</p>



    </div>
  </body>
</html>


