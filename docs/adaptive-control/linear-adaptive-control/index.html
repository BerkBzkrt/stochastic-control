<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Aditya Mahajan" />
  <meta name="title" content="ECSE 506: Stochastic Control and Decision Theory" />
  <title>ECSE 506: Stochastic Control and Decision Theory</title>
  
  <meta content="Linear systems,Adaptive control,LQR" name="keywords" />
  

  <link rel="stylesheet" href="https://adityam.github.io/stochastic-control//css/style.css" type="text/css" /><script type="text/javascript"
    src="https://cdn.plot.ly/plotly-basic-latest.min.js">
  </script><script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/5.10.3/math.min.js">
  </script>
  <script src="https://adityam.github.io/stochastic-control//js/random-0.26.js"></script><script type="text/javascript"
    src="https://adityam.github.io/stochastic-control/js/mathjax-local.js" defer>
  </script>
  <script type="text/javascript" id="MathJax-script" defer
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
  </script>

  <script type="module" defer
    src="//instant.page/3.0.0"
    integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1">
  </script>
</head>
<body>
<div id="content">
<div class="title">
  <h1>ECSE 506: Stochastic Control and Decision Theory </h1>
  <h2><a href="http://www.cim.mcgill.ca/~adityam/">Aditya Mahajan</a> <br/>
      Winter 2020
  </h2>
  <h3><a href="https://adityam.github.io/stochastic-control/ ">About</a>
	&nbsp;<small><small>|</small></small>&nbsp;
    <a href="https://adityam.github.io/stochastic-control//lectures">Lectures</a></span>
	&nbsp;<small><small>|</small></small>&nbsp;
    <a href="https://adityam.github.io/stochastic-control//notes">Notes</a></span>
	&nbsp;<small><small>|</small></small>&nbsp;
    <a href="https://adityam.github.io/stochastic-control//coursework">Coursework</a>
</h3>
</div>



<div class="h1-title">Adaptive control of linear systems</div>

<p>We start with a simple example to illustrate that it is possible to control a linear system with unknown dymamics. Consider a scalar linear system <span class="math display">\[ x_{t+1} = a x_t + b u_t + w_t \]</span> where <span class="math inline">\(x_t, u_t, w_t \in \reals\)</span> and <span class="math inline">\(\{w_t\}_{t \ge 1}\)</span> is an i.i.d. process with zero mean and variance <span class="math inline">\(σ^2\)</span>. Suppse the per-step cost is <span class="math inline">\(c(x_t, u_t) = x_t^2\)</span> and our objective is to minimize the long-term average cost <span class="math display">\[ 
  \lim_{T \to ∞} \frac{1}{T} \EXP\Bigl[ \sum_{t=1}^T x_t^2 \Bigr].
\]</span> This is perhaps the simplest instance of an <a href="../../linear-systems/lqr">LQR</a> problem. It is easy to verify that the solution of the discrete-time algebric Riccati equation is given by <span class="math inline">\(S = 1\)</span> and therefore the optimal control action is <span class="math display">\[
  u_t = - \frac{a}{b} x_t
\]</span> and the optimal average cost is <span class="math inline">\(1\)</span>.</p>
<p>Now suppose the parameters <span class="math inline">\(θ = \VEC(a,b)\)</span> are unknown. Suppose we use linear least squares estimates to identify <span class="math inline">\(θ\)</span>. Let <span class="math inline">\(z_t\)</span> denote <span class="math inline">\(\VEC(x_t, u_t)\)</span>. Note that we can write <span class="math display">\[ x_{t+1} = z_t^\TRANS θ + w_t. \]</span></p>
<p>Combining oberrvations until time <span class="math inline">\(t\)</span>, we have <span class="math display">\[ \MATRIX{x_2 \\ \vdots \\ x_{t}} = 
   \MATRIX{z_1^\TRANS \\ \vdots \\ z_{t-1}^\TRANS } θ + 
   \MATRIX{w_1 \\ \vdots \\ w_{t-1}} \]</span> which may be written in vector form as <span class="math display">\[ X_t = Z_t θ + W_t, \]</span> where <span class="math display">\[ 
 X_t = \MATRIX{x_2 \\ \vdots \\ x_{t}}, \quad
 Z_t = \MATRIX{z_1^\TRANS \\ \vdots \\ z_{t-1}^\TRANS }, \quad
 W_t = \MATRIX{w_1 \\ \vdots \\ w_{t-1}}. \]</span></p>
<p>Thus, the linear least squares estimator of <span class="math inline">\(θ\)</span> is given by <span class="math display">\[ \hat θ_t = (Z_t^\TRANS Z_t)^{-1} Z_t^\TRANS X_t
    = \bigl[ \sum_{τ = 1}^{t-1} z_τ z_τ^\TRANS \bigr]^{-1}
              \sum_{τ=1}^{t-1} z_τ x_{τ+1}. \]</span></p>
<p>The linear least squares estimate can be written in recursive form as: <span class="math inline">\(x_0 = 0\)</span>, <span class="math inline">\(\Sigma_0 = 1\)</span>, and for <span class="math inline">\(t \ge 0\)</span>: <span class="math display">\[\begin{align*}
  \hat θ_{t+1} &amp;= \hat θ_t + 
  \frac{ \Sigma_t z_t ( x_{t+1} - z_t^\TRANS \hat θ_t) }{1 + z_t^\TRANS \Sigma_t z_t },
  \\
  \Sigma_{t+1} &amp;= \Sigma_t - 
  \frac{ \Sigma_t z_t z_t^\TRANS \Sigma_t }{ 1 + z_t^\TRANS \Sigma_t z_t }.
\end{align*}\]</span></p>
<p>Note that it can also be shown that the covariance <span class="math inline">\(\Sigma_t\)</span> satisfies the recusion <span class="math display">\[ 
  \Sigma_{t+1}^{-1} = \Sigma_t^{-1} + z_t z_t^\TRANS.
\]</span></p>
<p>Now, let <span class="math inline">\(\hat θ_t = (\hat a_t, \hat b_t)\)</span>. The certainty equivalent control law is given by <span class="math display">\[
  u_t = - \frac{\hat a_t}{\hat b_t} x_t.
\]</span></p>
<p>It can be shown that the sequence <span class="math inline">\(\{ \hat a_t/ \hat b_t\}_{t \ge 1}\)</span> converges to <span class="math inline">\(a/b\)</span>, so asymptotically we will use the right control law, even though <span class="math inline">\(\hat θ_t\)</span> does not converge to <span class="math inline">\(θ\)</span>.</p>
<p>Let’s run a simple simulation to test this. Suppose $a = $ <input id="ex1a"
       type="number"    step = 0.1
       maxlength = "3"  size = "2"
       min = "-10"      max  = "10"
       onkeyup  = "ex1Plot()"
       onchange = "ex1Plot()"
       value = "" />, $b = $ <input id="ex1b"
       type="number"    step = 0.1
       maxlength = "3"  size = "2"
       min = "-10"      max  = "10"
       onkeyup  = "ex1Plot()"
       onchange = "ex1Plot()"
       value = "" />, and $σ = $ <input id="ex1σ"
       type="number"    step = 0.1
       maxlength = "3"  size = "2"
       min = "0"      max  = "10"
       onkeyup  = "ex1Plot()"
       onchange = "ex1Plot()"
       value = "" />. The resulting plot for a single sample path is shown below. You can generate another sample path by clicking <button onClick="ex1Plot()">Re-run</button></p>
<div class="flex">
<div id="ex1:cost" style="width:800px; height:250px;">

</div>
<div id="ex1:parameters" style="width:800px; height:250px;">

</div>
</div>
<script>
if (pagedata == undefined) { var pagedata = { } }

pagedata.adaptiveControl = { a : 1.1, b : 1, σ : 1, T : 1000 }

// Set initial values
document.getElementById('ex1a').value = pagedata.adaptiveControl.a;
document.getElementById('ex1b').value = pagedata.adaptiveControl.b;
document.getElementById('ex1σ').value = pagedata.adaptiveControl.σ;

function show_plot(dom, x, y, xtitle, ytitle) {
  var data = [{
      x : x,
      y : y,
      line : {
        shape : "spline",
      }, 
      mode : "lines" , 
  }];

  var layout = { 
      paper_bgcolor: "#fffff8",
      plot_bgcolor:  "#fffff8",
      xaxis : {
        title: xtitle,
        showgrid: true,
        showline: true,
        zeroline: false,
        showticklabels: true,
      },
      yaxis : {
        title: ytitle,
        showgrid: true,
        showline: true,
        zeroline: false,
        showticklabels: true,
      },
      automargin: true,
      margin: {
        l : 75,
        r : 15,
        b : 75,
        t : 15,
        pad : 15
      } ,
      hovermode: false,
  };

  var options = {
      staticPlot: true,
      displayModeBar: false,
  };

  Plotly.newPlot(dom, data, layout, options);
}

function ex1Plot() { 
  var T = pagedata.adaptiveControl.T ; 

  var stream = new Random();

  var a = document.getElementById('ex1a').valueAsNumber;
  var b = document.getElementById('ex1b').valueAsNumber;
  var σ = document.getElementById('ex1σ').valueAsNumber;

  var x = 0;
  var u = 0;
  var w = 0;

  var z = math.zeros(2);
  var θ = math.matrix([0, 1]); // Cannot start with b = 0!
  var Σ = math.ones(2,2);

  var time = Array(T);
  var cost = Array(T);
  var avg  = Array(T);

  var hat_a = Array(T);
  var hat_b = Array(T); 

  var gain  = Array(T);


  for (var t = 0; t < T; t++) {
    time[t] = t;
    if(t == 0) {
      cost[t] = x*x;
    } else {
      cost[t] = cost[t-1] + x*x;
    }
    avg[t] = cost[t]/t;

    // math.js has weird syntax to index element
    hat_a = math.subset(θ, math.index(0));
    hat_b = math.subset(θ, math.index(1));

    gain[t] = hat_a/hat_b;

    u = - gain[t]*x;
    w = stream.normal(0, σ);
    z = math.matrix([x, u]);
    
    x = a*x + b*u + w;

    // θ = Θ + Σ*z*(x - z'*θ)/(1 + z'*Σ*z)
    var normalize = 1 +  math.chain(z)
                             .transpose()
                             .multiply(Σ)
                             .multiply(z)
                             .squeeze()
                             .done();

    var innovation = x - math.dot(z,θ);

    θ = math.add(θ, math.chain(Σ).multiply(z).multiply(innovation/normalize).done());
    Σ = math.subtract(Σ, math.chain(Σ).multiply(z).multiply(math.transpose(z)).multiply(Σ).done());

    // Clamp the values of θ and Σ
    function clamp(val) {
        if (val >= 100) {
          console.log("Unstanble learning: clamping parameters")
          val = 100;
        } else if (val <= -100) {
          console.log("Unstanble learning: clamping parameters")
          val = -100;
        }
        return val;
    }
    math.map(θ, clamp)
    math.map(Σ, clamp)

  }

  show_plot('ex1:cost', time, avg, "Time", "Average cost");
  show_plot('ex1:parameters', time, gain, "Time", "Controller gain");
}

ex1Plot()


</script>


<p class="categories">
This entry 

 was last updated on 04 Jun 2020
 and posted in 

<a href="https://adityam.github.io/stochastic-control/categories/rl">
  RL</a>
and tagged
<a href="https://adityam.github.io/stochastic-control/tags/linear-systems">linear systems</a>,
<a href="https://adityam.github.io/stochastic-control/tags/adaptive-control">adaptive control</a>,
<a href="https://adityam.github.io/stochastic-control/tags/lqr">lqr</a>.</p>



      <script type="text/javascript">
      
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-6887174-4']);
            _gaq.push(['_trackPageview']);
            (function() {
                var ga   = document.createElement('script');
                ga.type  = 'text/javascript';
                ga.async = true;
                ga.src   = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(ga, s);
              })();
      
      </script>
    </div>
  </body>
</html>


